<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>MotoSpeed GPS</title>
  <link rel="manifest" href="manifest.json"/>
  <meta name="theme-color" content="#070010"/>
  <meta name="mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&family=Exo+2:wght@300;700;900&display=swap" rel="stylesheet"/>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
    :root{
      --v:#7c3aed;--vl:#c084fc;
      --f:#ea580c;--fl:#fb923c;--gold:#fbbf24;
      --g:#4ade80;
    }

    html,body{width:100%;height:100%;overflow:hidden;}

    body{
      font-family:'Share Tech Mono',monospace;
      background:#070010;color:#fff;
      user-select:none;
      display:flex;flex-direction:column;
      width:100vw;height:100dvh;
      overflow:hidden;
      position:fixed;inset:0;
    }

    /* Grid bg */
    body::before{
      content:'';position:fixed;inset:0;
      background-image:
        linear-gradient(rgba(124,58,237,0.05) 1px,transparent 1px),
        linear-gradient(90deg,rgba(234,88,12,0.05) 1px,transparent 1px);
      background-size:28px 28px;
      pointer-events:none;z-index:0;
    }
    body::after{
      content:'';position:fixed;inset:0;
      background:
        radial-gradient(ellipse at 15% 10%,rgba(124,58,237,0.2) 0%,transparent 45%),
        radial-gradient(ellipse at 85% 90%,rgba(234,88,12,0.15) 0%,transparent 45%);
      pointer-events:none;z-index:0;
    }

    /* Scan line */
    .scan{
      position:fixed;left:0;right:0;height:3px;z-index:50;pointer-events:none;
      background:linear-gradient(90deg,transparent,var(--vl),var(--fl),transparent);
      box-shadow:0 0 14px rgba(192,132,252,0.9),0 0 14px rgba(251,146,60,0.6);
      animation:scanDown 5s linear infinite;
    }
    @keyframes scanDown{0%{top:-3px;opacity:0;}4%{opacity:1;}96%{opacity:1;}100%{top:100%;opacity:0;}}

    #particles{position:fixed;inset:0;z-index:1;pointer-events:none;}

    /* Corner accents */
    .c-tr{position:fixed;top:0;right:0;width:44px;height:44px;z-index:15;pointer-events:none;
      background:linear-gradient(225deg,var(--v) 45%,transparent 45%);}
    .c-bl{position:fixed;bottom:0;left:0;width:28px;height:28px;z-index:15;pointer-events:none;
      background:linear-gradient(45deg,var(--f) 45%,transparent 45%);}

    /* Flames */
    .flames{position:fixed;bottom:0;left:0;right:0;height:60px;pointer-events:none;z-index:2;overflow:hidden;}
    .flame{position:absolute;bottom:0;border-radius:50% 50% 20% 20%;animation:flameUp linear infinite;}
    .flame:nth-child(1){left:3%; width:3px;background:rgba(168,85,247,0.6);animation-duration:2.0s;animation-delay:0.0s;}
    .flame:nth-child(2){left:13%;width:5px;background:rgba(249,115,22,0.7);animation-duration:1.7s;animation-delay:0.4s;}
    .flame:nth-child(3){left:23%;width:3px;background:rgba(251,191,36,0.5);animation-duration:2.3s;animation-delay:0.8s;}
    .flame:nth-child(4){left:35%;width:6px;background:rgba(168,85,247,0.5);animation-duration:1.5s;animation-delay:0.2s;}
    .flame:nth-child(5){left:47%;width:4px;background:rgba(249,115,22,0.8);animation-duration:2.1s;animation-delay:0.6s;}
    .flame:nth-child(6){left:58%;width:5px;background:rgba(168,85,247,0.6);animation-duration:1.9s;animation-delay:1.0s;}
    .flame:nth-child(7){left:69%;width:3px;background:rgba(251,191,36,0.6);animation-duration:2.2s;animation-delay:0.3s;}
    .flame:nth-child(8){left:80%;width:6px;background:rgba(249,115,22,0.7);animation-duration:1.6s;animation-delay:0.7s;}
    .flame:nth-child(9){left:91%;width:3px;background:rgba(168,85,247,0.5);animation-duration:2.4s;animation-delay:0.1s;}
    @keyframes flameUp{0%{height:0;opacity:0;}15%{opacity:1;}75%{opacity:0.5;}100%{height:55px;opacity:0;transform:scaleX(0.2);}}

    /* ── APP — ocupa toda la pantalla ── */
    .app{
      position:relative;z-index:10;
      width:100%;height:100dvh;
      display:flex;flex-direction:column;
    }

    /* ── HEADER (compacto) ── */
    .hdr{
      flex-shrink:0;
      padding:8px 14px 6px;
      display:flex;justify-content:space-between;align-items:center;
      border-bottom:1px solid rgba(124,58,237,0.35);
      background:linear-gradient(90deg,rgba(124,58,237,0.1),rgba(234,88,12,0.07));
    }
    .logo{
      font-family:'Orbitron',sans-serif;
      font-size:clamp(14px,4vw,20px);font-weight:900;letter-spacing:3px;
      background:linear-gradient(135deg,var(--vl),var(--fl));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
    }
    .hdr-right{display:flex;flex-direction:column;align-items:flex-end;gap:3px;}
    .status{
      font-size:clamp(8px,2.2vw,11px);letter-spacing:3px;
      display:flex;align-items:center;gap:5px;color:rgba(255,255,255,0.3);
    }
    .sdot{width:7px;height:7px;border-radius:50%;background:#333;transition:all 0.3s;}
    .status.active{color:var(--g);}
    .status.active .sdot{background:var(--g);box-shadow:0 0 10px var(--g);animation:sdAnim 2s infinite;}
    .status.error{color:#ef4444;}
    .status.error .sdot{background:#ef4444;box-shadow:0 0 10px #ef4444;}
    @keyframes sdAnim{0%,100%{transform:scale(1);opacity:1;}50%{transform:scale(1.6);opacity:0.4;}}
    .rec-badge{
      font-size:clamp(8px,2vw,10px);letter-spacing:2px;padding:2px 8px;
      border:1px solid rgba(251,146,60,0.6);color:var(--fl);
      box-shadow:0 0 8px rgba(251,146,60,0.3);
      animation:recAnim 1.6s ease-in-out infinite;display:none;
    }
    .rec-badge.on{display:block;}
    @keyframes recAnim{0%,100%{opacity:1;}50%{opacity:0.3;box-shadow:0 0 18px rgba(251,146,60,0.9);}}

    /* ── SPEED HERO (sección principal — más grande) ── */
    .speed-hero{
      flex:0 0 auto;
      padding:10px 14px 6px;
      display:flex;align-items:center;
      border-bottom:1px solid rgba(255,255,255,0.05);
      gap:0;
    }

    /* Número de velocidad — MÁS GRANDE */
    .spd-left{position:relative;display:flex;flex-direction:column;align-items:flex-start;}

    .streaks{
      position:absolute;right:calc(100% + 4px);top:0;bottom:0;
      display:flex;flex-direction:column;justify-content:center;gap:7px;pointer-events:none;
    }
    .streak{height:2px;border-radius:1px;transform-origin:right center;animation:stk 2s ease-in-out infinite;}
    .streak:nth-child(1){width:44px;background:linear-gradient(90deg,transparent,var(--vl));animation-delay:0.0s;}
    .streak:nth-child(2){width:26px;background:linear-gradient(90deg,transparent,var(--fl));animation-delay:0.35s;}
    .streak:nth-child(3){width:56px;background:linear-gradient(90deg,transparent,var(--vl));animation-delay:0.7s;}
    .streak:nth-child(4){width:18px;background:linear-gradient(90deg,transparent,var(--fl));animation-delay:0.2s;}
    .streak:nth-child(5){width:36px;background:linear-gradient(90deg,transparent,var(--vl));animation-delay:0.9s;}
    @keyframes stk{0%,100%{transform:scaleX(0.1);opacity:0;}45%,55%{transform:scaleX(1);opacity:1;}}

    /* Número GRANDE — usa vw para escalar con el ancho del celular */
    .spd-num{
      font-family:'Exo 2',sans-serif;
      font-size:clamp(100px,28vw,140px);
      font-weight:900;line-height:0.82;letter-spacing:-6px;color:#fff;
      position:relative;
      text-shadow:
        0 0 30px rgba(192,132,252,1),
        0 0 70px rgba(124,58,237,0.6),
        4px 4px 0 rgba(251,146,60,0.2);
      animation:nFuse 3s ease-in-out infinite;
    }
    .spd-num.fast{animation:nFuse 3s ease-in-out infinite,shake 0.1s linear infinite;}
    @keyframes shake{0%,100%{transform:translateX(0);}25%{transform:translateX(-3px);}75%{transform:translateX(3px);}}
    @keyframes nFuse{
      0%,100%{text-shadow:0 0 30px rgba(192,132,252,1),0 0 70px rgba(124,58,237,0.6),4px 4px 0 rgba(251,146,60,0.2);}
      50%{text-shadow:0 0 50px rgba(251,146,60,1),0 0 100px rgba(234,88,12,0.7),-4px -4px 0 rgba(192,132,252,0.3);}
    }
    .spd-num::before{
      content:attr(data-v);position:absolute;inset:0;
      color:var(--vl);opacity:0.15;
      clip-path:polygon(0 18%,100% 18%,100% 32%,0 32%);
      animation:glA 5s infinite;
    }
    .spd-num::after{
      content:attr(data-v);position:absolute;inset:0;
      color:var(--fl);opacity:0.15;
      clip-path:polygon(0 65%,100% 65%,100% 78%,0 78%);
      animation:glB 5s infinite;
    }
    @keyframes glA{0%,85%,100%{transform:translateX(3px);opacity:0.15;}87%{transform:translateX(-9px);opacity:0.6;}89%{transform:translateX(6px);opacity:0.1;}91%{transform:translateX(0);opacity:0.5;}}
    @keyframes glB{0%,81%,100%{transform:translateX(-3px);opacity:0.15;}83%{transform:translateX(9px);opacity:0.6;}85%{transform:translateX(-6px);opacity:0.1;}87%{transform:translateX(0);opacity:0.5;}}

    .spd-unit{
      font-size:clamp(10px,2.8vw,14px);letter-spacing:5px;margin-top:4px;
      background:linear-gradient(90deg,var(--vl),var(--fl));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
    }

    /* ── GEAR BADGE — grande y visible ── */
    .gear-wrap{
      margin-left:auto;
      display:flex;flex-direction:column;align-items:center;gap:4px;
    }
    .gear-badge{
      width:clamp(72px,18vw,90px);height:clamp(72px,18vw,90px);
      border-radius:50%;
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      border:2px solid var(--v);
      background:rgba(124,58,237,0.12);
      box-shadow:0 0 24px rgba(124,58,237,0.5),inset 0 0 24px rgba(124,58,237,0.05);
      transition:all 0.3s;
    }
    .gear-badge.flash{animation:gFlash 0.4s ease-out forwards;}
    @keyframes gFlash{
      0%{box-shadow:0 0 60px rgba(192,132,252,1),inset 0 0 40px rgba(192,132,252,0.4);border-color:var(--vl);}
      100%{box-shadow:0 0 24px rgba(124,58,237,0.5),inset 0 0 24px rgba(124,58,237,0.05);border-color:var(--v);}
    }
    .gear-badge.warn{border-color:var(--fl);animation:wPulse 0.5s ease-in-out infinite;}
    @keyframes wPulse{0%,100%{box-shadow:0 0 20px rgba(251,146,60,0.5);}50%{box-shadow:0 0 45px rgba(251,146,60,1),0 0 70px rgba(251,146,60,0.35);}}
    .gear-num{
      font-family:'Orbitron',sans-serif;
      font-size:clamp(28px,8vw,38px);font-weight:900;line-height:1;
      color:var(--vl);text-shadow:0 0 18px rgba(192,132,252,0.9);
    }
    .gear-lbl{font-size:clamp(7px,2vw,9px);letter-spacing:2px;color:rgba(255,255,255,0.25);margin-top:1px;}
    .gear-name{font-size:clamp(9px,2.5vw,12px);letter-spacing:2px;color:rgba(192,132,252,0.6);}

    /* ── SHIFT ALERT ── */
    .shift-alert{
      display:none;margin:0;padding:5px 14px;flex-shrink:0;
      background:rgba(251,146,60,0.12);
      border-top:1px solid rgba(251,146,60,0.4);border-bottom:1px solid rgba(251,146,60,0.4);
      border-left:4px solid var(--fl);
      font-size:clamp(10px,3vw,13px);letter-spacing:4px;color:var(--fl);text-align:center;
      animation:aPulse 0.7s ease-in-out infinite;
    }
    .shift-alert.on{display:block;}
    @keyframes aPulse{0%,100%{opacity:1;}50%{opacity:0.3;}}

    /* ── ACCEL BAR — grande, visible, pro ── */
    .accel-section{
      flex-shrink:0;
      padding:8px 14px 6px;
      border-bottom:1px solid rgba(255,255,255,0.04);
    }
    .accel-header{
      display:flex;justify-content:space-between;align-items:center;
      margin-bottom:6px;
    }
    .accel-label{font-size:clamp(9px,2.5vw,11px);letter-spacing:3px;color:rgba(255,255,255,0.25);}
    .accel-value{
      font-family:'Orbitron',sans-serif;
      font-size:clamp(14px,4vw,18px);font-weight:700;letter-spacing:1px;
      transition:all 0.2s;
    }
    .accel-value.pos{color:var(--g);text-shadow:0 0 12px rgba(74,222,128,0.8);}
    .accel-value.neg{color:var(--fl);text-shadow:0 0 12px rgba(251,146,60,0.8);}
    .accel-value.zero{color:rgba(255,255,255,0.25);}

    /* The track — tall enough to see from 60cm */
    .accel-track{
      height:clamp(14px,3.5vw,20px);
      background:rgba(255,255,255,0.04);
      border-radius:10px;
      position:relative;overflow:hidden;
      border:1px solid rgba(255,255,255,0.07);
    }
    /* Center divider */
    .accel-track::before{
      content:'';position:absolute;left:50%;top:0;bottom:0;width:2px;
      background:rgba(255,255,255,0.2);transform:translateX(-50%);z-index:3;
    }
    /* Braking (left, orange) */
    .accel-brake{
      position:absolute;right:50%;top:0;bottom:0;width:0%;
      background:linear-gradient(90deg,rgba(234,88,12,0.2),var(--fl));
      border-radius:10px 0 0 10px;
      box-shadow:0 0 16px rgba(251,146,60,0.7);
      transition:width 0.2s ease-out;
    }
    /* Accelerating (right, green→violet) */
    .accel-go{
      position:absolute;left:50%;top:0;bottom:0;width:0%;
      background:linear-gradient(90deg,var(--vl),var(--g));
      border-radius:0 10px 10px 0;
      box-shadow:0 0 16px rgba(74,222,128,0.7);
      transition:width 0.2s ease-out;
      overflow:visible;
    }
    /* Glow tip on accel */
    .accel-go::after{
      content:'';position:absolute;right:-6px;top:50%;transform:translateY(-50%);
      width:clamp(12px,3vw,16px);height:clamp(12px,3vw,16px);border-radius:50%;
      background:#fff;
      box-shadow:0 0 12px var(--g),0 0 25px rgba(74,222,128,0.6);
      animation:tipGlow 1s ease-in-out infinite;
    }
    /* Glow tip on brake */
    .accel-brake::before{
      content:'';position:absolute;left:-6px;top:50%;transform:translateY(-50%);
      width:clamp(12px,3vw,16px);height:clamp(12px,3vw,16px);border-radius:50%;
      background:#fff;
      box-shadow:0 0 12px var(--fl),0 0 25px rgba(251,146,60,0.6);
      animation:tipGlow 1s ease-in-out infinite;
    }
    @keyframes tipGlow{0%,100%{transform:translateY(-50%) scale(1);}50%{transform:translateY(-50%) scale(1.5);}}

    /* Segmented ticks on track */
    .accel-ticks{
      position:absolute;inset:0;display:flex;pointer-events:none;z-index:2;
    }
    .tick{flex:1;border-right:1px solid rgba(255,255,255,0.06);}
    .tick:last-child{border-right:none;}

    /* ── DATA ROW (km, time, max) ── */
    .data-row{
      flex-shrink:0;
      display:grid;grid-template-columns:1fr 1px 1fr 1px 1fr;
      border-top:1px solid rgba(124,58,237,0.25);
      border-bottom:1px solid rgba(234,88,12,0.25);
      background:linear-gradient(90deg,rgba(124,58,237,0.05),rgba(234,88,12,0.05));
    }
    .data-div{background:rgba(255,255,255,0.06);}
    .data-cell{padding:10px 8px;text-align:center;}
    .data-val{
      font-family:'Orbitron',sans-serif;
      font-size:clamp(16px,4.5vw,22px);font-weight:700;
      display:block;letter-spacing:1px;
      animation:dGlow 3s ease-in-out infinite;
    }
    .data-val.dist{
      color:var(--vl);text-shadow:0 0 12px rgba(192,132,252,0.6);
      font-size:clamp(14px,3.8vw,18px);/* distancia puede ser más larga */
    }
    .data-val.time{color:#fff;text-shadow:0 0 8px rgba(255,255,255,0.3);animation-delay:.5s;}
    .data-val.mspd{color:var(--fl);text-shadow:0 0 12px rgba(251,146,60,0.6);animation-delay:1s;}
    .data-val.mspd.pop{animation:maxPop 0.5s ease-out;}
    @keyframes maxPop{0%{color:var(--gold);text-shadow:0 0 30px var(--gold),0 0 60px rgba(251,191,36,0.5);transform:scale(1.25);}100%{transform:scale(1);}}
    @keyframes dGlow{0%,100%{filter:brightness(1);}50%{filter:brightness(1.5);}}
    .data-label{font-size:clamp(7px,2vw,9px);letter-spacing:3px;color:rgba(255,255,255,0.2);margin-top:3px;}

    /* ── PROGRESS BAR ── */
    .prog-wrap{flex-shrink:0;padding:6px 14px;}
    .prog-meta{display:flex;justify-content:space-between;margin-bottom:5px;}
    .prog-meta span{font-size:clamp(8px,2.2vw,10px);letter-spacing:1px;color:rgba(255,255,255,0.2);}
    .prog-track{height:clamp(6px,1.5vw,8px);background:rgba(255,255,255,0.05);border-radius:4px;position:relative;}
    .prog-fill{
      height:100%;width:0%;border-radius:4px;
      background:linear-gradient(90deg,#5b21b6,var(--v),var(--f),var(--gold));
      box-shadow:0 0 12px rgba(124,58,237,0.8),0 0 24px rgba(234,88,12,0.35);
      transition:width 0.7s ease;position:relative;
    }
    .prog-fill::after{
      content:'';position:absolute;right:-6px;top:50%;transform:translateY(-50%);
      width:clamp(12px,3vw,14px);height:clamp(12px,3vw,14px);border-radius:50%;background:#fff;
      box-shadow:0 0 10px var(--vl),0 0 20px var(--f);
      animation:dPop 1.5s ease-in-out infinite;
    }
    @keyframes dPop{0%,100%{transform:translateY(-50%) scale(1);}50%{transform:translateY(-50%) scale(1.6);}}

    /* ── BUTTONS ── */
    .controls{
      flex-shrink:0;
      display:grid;grid-template-columns:1fr 1fr;
      gap:8px;padding:8px 14px 6px;
    }
    .btn{
      padding:clamp(12px,3.5vw,18px) 8px;border:none;
      font-family:'Orbitron',sans-serif;
      font-size:clamp(10px,3vw,13px);font-weight:700;
      letter-spacing:2px;text-transform:uppercase;cursor:pointer;
      transition:all 0.2s;
      clip-path:polygon(8px 0,100% 0,calc(100% - 8px) 100%,0 100%);
      position:relative;overflow:hidden;
    }
    .btn::after{
      content:'';position:absolute;top:0;left:-100%;width:50%;height:100%;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,0.13),transparent);
      animation:bShine 3s linear infinite;
    }
    @keyframes bShine{0%{left:-100%}100%{left:200%}}
    .btn:active{transform:scale(0.95);}
    .btn-start{background:rgba(124,58,237,0.18);color:var(--vl);border:1px solid rgba(124,58,237,0.6);text-shadow:0 0 10px rgba(192,132,252,0.7);}
    .btn-pause{background:rgba(251,146,60,0.15);color:var(--fl);border:1px solid rgba(234,88,12,0.6);text-shadow:0 0 10px rgba(251,146,60,0.7);}
    .btn-reset{background:rgba(234,88,12,0.1);color:var(--fl);border:1px solid rgba(234,88,12,0.45);}
    .btn-hist{grid-column:1/-1;clip-path:none;background:rgba(255,255,255,0.03);color:rgba(255,255,255,0.3);border:1px solid rgba(255,255,255,0.08);letter-spacing:4px;}
    .btn-hist:hover,.btn-hist:active{background:rgba(255,255,255,0.08);color:rgba(255,255,255,0.7);}

    /* ── HISTORY ── */
    .history-panel{
      flex:1;overflow-y:auto;
      margin:0 14px 8px;
      border:1px solid rgba(124,58,237,0.2);
      background:rgba(0,0,0,0.3);
      display:none;
    }
    .history-panel.on{display:block;}
    .history-panel::-webkit-scrollbar{width:3px;}
    .history-panel::-webkit-scrollbar-thumb{background:rgba(124,58,237,0.5);border-radius:2px;}
    .history-inner{padding:12px 14px;}
    .history-title{
      font-size:clamp(9px,2.5vw,11px);letter-spacing:4px;
      background:linear-gradient(90deg,var(--vl),var(--fl));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
      margin-bottom:10px;display:flex;align-items:center;gap:8px;
    }
    .history-title::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,rgba(124,58,237,0.3),rgba(234,88,12,0.3));}
    .history-item{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.05);}
    .history-item:last-child{border-bottom:none;}
    .hist-km{
      font-family:'Orbitron',sans-serif;font-size:clamp(14px,4vw,17px);
      background:linear-gradient(135deg,var(--vl),var(--fl));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
    }
    .hist-meta{font-size:clamp(8px,2vw,10px);color:rgba(255,255,255,0.2);margin-top:2px;}
    .hist-max{font-family:'Orbitron',sans-serif;font-size:clamp(12px,3.5vw,15px);color:var(--vl);text-align:right;}
    .hist-max-lbl{font-size:clamp(7px,2vw,9px);letter-spacing:2px;color:rgba(255,255,255,0.15);text-align:right;margin-top:2px;}
    .no-history{text-align:center;color:rgba(255,255,255,0.18);font-size:clamp(9px,2.5vw,11px);letter-spacing:3px;padding:20px 0;}
  </style>
</head>
<body>
  <canvas id="particles"></canvas>
  <div class="scan"></div>
  <div class="flames">
    <div class="flame"></div><div class="flame"></div><div class="flame"></div>
    <div class="flame"></div><div class="flame"></div><div class="flame"></div>
    <div class="flame"></div><div class="flame"></div><div class="flame"></div>
  </div>
  <div class="c-tr"></div>
  <div class="c-bl"></div>

  <div class="app">

    <!-- HEADER -->
    <div class="hdr">
      <div class="logo">MOTOSPEED</div>
      <div class="hdr-right">
        <div class="status" id="statusEl">
          <div class="sdot"></div>
          <span id="statusText">INIT GPS</span>
        </div>
        <div class="rec-badge" id="recBadge">● REC</div>
      </div>
    </div>

    <!-- SPEED + GEAR -->
    <div class="speed-hero">
      <div class="spd-left">
        <div class="streaks">
          <div class="streak"></div><div class="streak"></div>
          <div class="streak"></div><div class="streak"></div><div class="streak"></div>
        </div>
        <div class="spd-num" id="speedNum" data-v="0">0</div>
        <div class="spd-unit">KM / H</div>
      </div>
      <div class="gear-wrap">
        <div class="gear-badge" id="gearBadge">
          <div class="gear-num" id="gearNum">—</div>
          <div class="gear-lbl">GEAR</div>
        </div>
        <div class="gear-name" id="gearName">—</div>
      </div>
    </div>

    <!-- SHIFT ALERT -->
    <div class="shift-alert" id="shiftAlert">⚠ SHIFT DOWN</div>

    <!-- ACCEL BAR -->
    <div class="accel-section">
      <div class="accel-header">
        <span class="accel-label">ACCELERATION</span>
        <span class="accel-value zero" id="accelVal">0.0 km/h·s</span>
      </div>
      <div class="accel-track">
        <div class="accel-ticks">
          <div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div>
          <div class="tick"></div><div class="tick"></div><div class="tick"></div><div class="tick"></div>
          <div class="tick"></div><div class="tick"></div>
        </div>
        <div class="accel-brake" id="accelBrake"></div>
        <div class="accel-go"    id="accelGo"></div>
      </div>
    </div>

    <!-- DATA ROW -->
    <div class="data-row">
      <div class="data-cell">
        <span class="data-val dist" id="tripDistance">0.00 km</span>
        <div class="data-label">DISTANCE</div>
      </div>
      <div class="data-div"></div>
      <div class="data-cell">
        <span class="data-val time" id="tripTime">00:00</span>
        <div class="data-label">TIME</div>
      </div>
      <div class="data-div"></div>
      <div class="data-cell">
        <span class="data-val mspd" id="maxSpeed">0</span>
        <div class="data-label">MAX km/h</div>
      </div>
    </div>

    <!-- PROGRESS BAR -->
    <div class="prog-wrap">
      <div class="prog-meta">
        <span>0</span><span id="progLabel">0 km/h</span><span>200</span>
      </div>
      <div class="prog-track"><div class="prog-fill" id="progFill"></div></div>
    </div>

    <!-- CONTROLS -->
    <div class="controls">
      <button class="btn btn-start" id="startStop">START</button>
      <button class="btn btn-reset" id="resetTrip">RESET</button>
      <button class="btn btn-hist"  id="toggleHistory">▼ TRIP HISTORY</button>
    </div>

    <!-- HISTORY -->
    <div class="history-panel" id="historySection">
      <div class="history-inner">
        <div class="history-title">Trip History</div>
        <div id="historyList"><div class="no-history">NO TRIPS RECORDED</div></div>
      </div>
    </div>

  </div>

  <script>
    // ── Particles ──
    const cvs=document.getElementById('particles');
    const pctx=cvs.getContext('2d');
    function resizeCvs(){cvs.width=window.innerWidth;cvs.height=window.innerHeight;}
    resizeCvs();window.addEventListener('resize',resizeCvs);
    const PC=['rgba(168,85,247,','rgba(192,132,252,','rgba(249,115,22,','rgba(251,146,60,','rgba(74,222,128,'];
    const pts=Array.from({length:40},()=>({
      x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,
      r:Math.random()*1.8+0.3,vx:(Math.random()-0.5)*0.3,vy:-Math.random()*0.45-0.1,
      c:PC[Math.floor(Math.random()*PC.length)],a:Math.random()*0.55+0.2,
      life:Math.random(),spd:Math.random()*0.004+0.002
    }));
    function drawPts(){
      pctx.clearRect(0,0,cvs.width,cvs.height);
      pts.forEach(p=>{
        p.life+=p.spd;
        if(p.life>1){p.life=0;p.x=Math.random()*cvs.width;p.y=cvs.height;}
        const a=p.a*Math.sin(p.life*Math.PI);
        pctx.beginPath();pctx.arc(p.x,p.y,p.r,0,Math.PI*2);
        pctx.fillStyle=p.c+a+')';pctx.fill();
        pctx.beginPath();pctx.arc(p.x,p.y,p.r*3.5,0,Math.PI*2);
        pctx.fillStyle=p.c+(a*0.1)+')';pctx.fill();
        p.x+=p.vx;p.y+=p.vy;
      });
      requestAnimationFrame(drawPts);
    }
    drawPts();

    // ── Gear logic ──
    const GEARS=[
      {num:'1',name:'1ST',max:15},
      {num:'2',name:'2ND',max:25},
      {num:'3',name:'3RD',max:35},
      {num:'4',name:'4TH',max:45},
      {num:'5',name:'5TH',max:999},
    ];
    const WARN=3;
    function getGearIdx(s){if(s<=0)return null;for(let i=0;i<GEARS.length;i++)if(s<=GEARS[i].max)return i;return GEARS.length-1;}
    function isWarn(s,i){if(i<=0)return false;return s<=(GEARS[i-1].max+WARN)&&s>GEARS[i-1].max;}

    // ── Main App ──
    class MotoSpeedometer{
      constructor(){
        this.watchId=null;this.lastPosition=null;
        this.currentSpeed=0;this.prevGearIdx=null;
        this.prevSpeed=0;this.prevSpeedTime=null;this.accel=0;

        this.tripDistance      =parseFloat(localStorage.getItem('tripDistance'))      ||0;
        this.maxSpeed          =parseFloat(localStorage.getItem('maxSpeed'))          ||0;
        this.currentTripDuration=parseInt(localStorage.getItem('currentTripDuration'))||0;
        this.isRecording       =localStorage.getItem('isRecording')==='true';
        this.tripStartTime     =Date.now()-this.currentTripDuration;
        this.pausedTime        =this.currentTripDuration;
        this.history           =this.loadHistory();
        this.isTracking        =false;
        this.init();
      }

      init(){
        this.setupListeners();
        this.startGPS();
        this.startTimer();
        this.updateDisplay();
        const btn=document.getElementById('startStop');
        if(this.isRecording){btn.textContent='PAUSE';btn.className='btn btn-pause';document.getElementById('recBadge').classList.add('on');}
        setInterval(()=>this.saveState(),30000);
      }

      setupListeners(){
        document.getElementById('startStop').addEventListener('click',()=>this.toggleRecording());
        document.getElementById('resetTrip').addEventListener('click',()=>this.resetTrip());
        document.getElementById('toggleHistory').addEventListener('click',()=>this.toggleHistory());
        if('wakeLock' in navigator){
          let wl=null;
          const req=async()=>{try{wl=await navigator.wakeLock.request('screen');}catch(e){}};
          const rel=()=>{if(wl){wl.release();wl=null;}};
          window.addEventListener('visibilitychange',()=>{if(document.visibilityState==='visible'&&this.isRecording)req();else rel();});
          if(this.isRecording)req();
          window.addEventListener('beforeunload',rel);
        }
      }

      startGPS(){
        if(!navigator.geolocation){this.updateStatus('GPS NOT AVAILABLE',true);return;}
        this.watchId=navigator.geolocation.watchPosition(
          p=>this.onPosition(p),e=>this.onGPSError(e),
          {enableHighAccuracy:true,timeout:10000,maximumAge:1000}
        );
        this.isTracking=true;
        this.updateStatus(this.isRecording?'RECORDING':'STANDBY');
      }

      onPosition(pos){
        this.isTracking=true;
        const spd=(pos.coords.speed!=null&&pos.coords.speed>=0)?pos.coords.speed*3.6:0;

        // Acceleration
        const now=Date.now();
        if(this.prevSpeedTime!==null){
          const dt=(now-this.prevSpeedTime)/1000;
          if(dt>0&&dt<3) this.accel=(spd-this.prevSpeed)/dt;
        }
        this.prevSpeed=spd;this.prevSpeedTime=now;
        this.currentSpeed=spd;

        // Max speed flash
        if(spd>this.maxSpeed){
          this.maxSpeed=spd;
          const el=document.getElementById('maxSpeed');
          el.classList.remove('pop');void el.offsetWidth;el.classList.add('pop');
        }

        // Distance
        if(this.isRecording&&this.lastPosition){
          const d=this.calcDist(
            this.lastPosition.coords.latitude,this.lastPosition.coords.longitude,
            pos.coords.latitude,pos.coords.longitude
          );
          if(spd>0.5)this.tripDistance+=d;
        }
        this.lastPosition=pos;
        this.updateDisplay();
      }

      onGPSError(e){
        const m={1:'GPS DENIED',2:'NO SIGNAL',3:'GPS TIMEOUT'};
        this.updateStatus(m[e.code]||'GPS ERROR',true);
      }

      calcDist(la1,lo1,la2,lo2){
        const R=6371,dLa=this.rad(la2-la1),dLo=this.rad(lo2-lo1);
        const a=Math.sin(dLa/2)**2+Math.cos(this.rad(la1))*Math.cos(this.rad(la2))*Math.sin(dLo/2)**2;
        return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
      }
      rad(d){return d*Math.PI/180;}

      updateDisplay(){
        const spd=Math.round(this.currentSpeed);

        // Speed number
        const nEl=document.getElementById('speedNum');
        nEl.textContent=spd;nEl.setAttribute('data-v',spd);
        nEl.classList.toggle('fast',spd>=100);

        // Distance, max speed
        document.getElementById('tripDistance').textContent=this.tripDistance.toFixed(2)+' km';
        document.getElementById('maxSpeed').textContent=Math.round(this.maxSpeed);

        // Progress bar
        const pct=Math.min((this.currentSpeed/200)*100,100);
        document.getElementById('progFill').style.width=pct+'%';
        document.getElementById('progLabel').textContent=spd+' km/h';

        // Accel bar (±20 km/h·s max range)
        const MAX_A=20;
        const cl=Math.max(-MAX_A,Math.min(MAX_A,this.accel));
        const p50=Math.abs(cl)/MAX_A*50;
        const goEl=document.getElementById('accelGo');
        const brEl=document.getElementById('accelBrake');
        const vEl=document.getElementById('accelVal');
        if(cl>0.5){
          goEl.style.width=p50+'%';brEl.style.width='0%';
          vEl.textContent='+'+this.accel.toFixed(1)+' km/h·s';vEl.className='accel-value pos';
        }else if(cl<-0.5){
          brEl.style.width=p50+'%';goEl.style.width='0%';
          vEl.textContent=this.accel.toFixed(1)+' km/h·s';vEl.className='accel-value neg';
        }else{
          goEl.style.width='0%';brEl.style.width='0%';
          vEl.textContent='0.0 km/h·s';vEl.className='accel-value zero';
        }

        // Gear
        const gIdx=getGearIdx(this.currentSpeed);
        const badge=document.getElementById('gearBadge');
        const gNum=document.getElementById('gearNum');
        const gName=document.getElementById('gearName');
        const alert=document.getElementById('shiftAlert');
        if(gIdx===null){
          gNum.textContent='—';gName.textContent='—';
          badge.classList.remove('warn','flash');alert.classList.remove('on');
        }else{
          const g=GEARS[gIdx];
          if(gIdx!==this.prevGearIdx){
            badge.classList.remove('flash');void badge.offsetWidth;badge.classList.add('flash');
            this.prevGearIdx=gIdx;
          }
          gNum.textContent=g.num;gName.textContent=g.name;
          const warn=isWarn(this.currentSpeed,gIdx);
          badge.classList.toggle('warn',warn);alert.classList.toggle('on',warn);
        }
      }

      startTimer(){
        setInterval(()=>{
          if(this.isRecording)this.currentTripDuration=Date.now()-this.tripStartTime;
          document.getElementById('tripTime').textContent=this.formatTime(this.currentTripDuration);
        },1000);
      }

      formatTime(ms){
        const t=Math.floor(ms/1000),m=Math.floor(t/60),s=t%60;
        return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
      }

      toggleRecording(){
        if(!this.isTracking){this.updateStatus('WAITING FOR GPS...',true);return;}
        this.isRecording=!this.isRecording;
        const btn=document.getElementById('startStop');
        const badge=document.getElementById('recBadge');
        if(this.isRecording){
          this.tripStartTime=Date.now()-this.pausedTime;
          btn.textContent='PAUSE';btn.className='btn btn-pause';
          badge.classList.add('on');this.updateStatus('RECORDING');
        }else{
          this.pausedTime=Date.now()-this.tripStartTime;
          btn.textContent='RESUME';btn.className='btn btn-start';
          badge.classList.remove('on');this.updateStatus('PAUSED');
        }
        this.saveState();localStorage.setItem('isRecording',this.isRecording);
      }

      resetTrip(){
        if(this.tripDistance>0||this.currentTripDuration>0){
          this.history.unshift({
            date:new Date().toLocaleDateString('en-US'),
            time:this.formatTime(this.currentTripDuration),
            distance:this.tripDistance,maxSpeed:this.maxSpeed,
            durationMs:this.currentTripDuration
          });
          this.saveHistory();
        }
        this.tripDistance=0;this.maxSpeed=0;
        this.currentTripDuration=0;this.pausedTime=0;
        this.tripStartTime=Date.now();this.isRecording=false;
        this.prevGearIdx=null;this.accel=0;
        this.saveState();localStorage.setItem('isRecording',false);
        this.updateDisplay();
        document.getElementById('startStop').textContent='START';
        document.getElementById('startStop').className='btn btn-start';
        document.getElementById('recBadge').classList.remove('on');
        document.getElementById('tripTime').textContent='00:00';
        document.getElementById('progFill').style.width='0%';
        this.updateHistoryDisplay();
        this.updateStatus(this.isTracking?'STANDBY':'INIT GPS');
      }

      saveState(){
        try{
          localStorage.setItem('tripDistance',this.tripDistance.toFixed(2));
          localStorage.setItem('maxSpeed',this.maxSpeed.toFixed(2));
          localStorage.setItem('currentTripDuration',this.currentTripDuration.toString());
        }catch(e){}
      }

      loadHistory(){try{return JSON.parse(localStorage.getItem('motoTripHistory')||'[]');}catch(e){return[];}}
      saveHistory(){try{localStorage.setItem('motoTripHistory',JSON.stringify(this.history.slice(0,50)));}catch(e){}}

      toggleHistory(){
        const sec=document.getElementById('historySection');
        const btn=document.getElementById('toggleHistory');
        const vis=sec.classList.toggle('on');
        btn.textContent=vis?'▲ HIDE HISTORY':'▼ TRIP HISTORY';
        if(vis)this.updateHistoryDisplay();
      }

      updateHistoryDisplay(){
        const list=document.getElementById('historyList');
        if(!this.history.length){list.innerHTML='<div class="no-history">NO TRIPS RECORDED</div>';return;}
        list.innerHTML=this.history.map(t=>{
          const time=t.durationMs?this.formatTime(t.durationMs):t.time||'N/A';
          const max=Math.round(t.maxSpeed||0);
          return `<div class="history-item">
            <div><div class="hist-km">${t.distance.toFixed(2)} km</div><div class="hist-meta">${t.date} · ${time}</div></div>
            <div><div class="hist-max">${max} km/h</div><div class="hist-max-lbl">MAX</div></div>
          </div>`;
        }).join('');
      }

      updateStatus(msg,isError=false){
        const el=document.getElementById('statusEl');
        document.getElementById('statusText').textContent=msg;
        el.className='status'+(isError?' error':(this.isTracking?' active':''));
      }
    }

    window.addEventListener('load',()=>{window.speedoInstance=new MotoSpeedometer();});
    window.addEventListener('beforeunload',()=>{
      const i=window.speedoInstance;
      if(i){i.saveState();i.saveHistory();localStorage.setItem('isRecording',i.isRecording);}
    });
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('service-worker.js')
        .then(r=>console.log('SW:',r.scope)).catch(e=>console.error('SW:',e));
    }
  </script>
</body>
</html>
